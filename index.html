<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#0a0a0f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<link rel="manifest" href="manifest.json">
<title>REACH ‚Äî Workout Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #0a0a0f; --surface: #14141f; --surface2: #1e1e2e; --surface3: #2a2a3e;
  --text: #eeeef2; --text-dim: #8888a0;
  --accent: #ff5e3a; --accent2: #ff2d78; --accent-glow: rgba(255,94,58,0.3);
  --cardio: #ff5e3a; --weights-upper: #7c5cff; --weights-lower: #5ca0ff;
  --yoga: #2dd4a8; --wellness: #ffc233; --radius: 16px;
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}
html, body { height:100%; font-family:'DM Sans',sans-serif; background:var(--bg); color:var(--text); overflow:hidden; -webkit-tap-highlight-color:transparent; }
.app { display:flex; flex-direction:column; height:100dvh; padding-bottom:var(--safe-bottom); }
.view-container { flex:1; overflow-y:auto; overflow-x:hidden; padding:12px 16px 16px; -webkit-overflow-scrolling:touch; }
.view-container::-webkit-scrollbar { display:none; }
.bottom-nav { display:flex; justify-content:space-around; align-items:center; padding:10px 0 12px; background:var(--surface); border-top:1px solid rgba(255,255,255,0.05); flex-shrink:0; }
.nav-item { display:flex; flex-direction:column; align-items:center; gap:3px; background:none; border:none; color:var(--text-dim); font-size:10px; font-family:inherit; font-weight:600; cursor:pointer; padding:4px 16px; transition:color .2s; }
.nav-item svg { width:24px; height:24px; }
.nav-item.active { color:var(--accent); }
.nav-item.active svg { filter:drop-shadow(0 0 6px var(--accent-glow)); }
.nav-item.log-btn { background:linear-gradient(135deg,var(--accent),var(--accent2)); color:white; width:56px; height:56px; border-radius:50%; margin-top:-28px; padding:0; box-shadow:0 4px 20px rgba(255,94,58,0.4); justify-content:center; font-size:0; }
.nav-item.log-btn svg { width:28px; height:28px; }
.view { display:none; } .view.active { display:block; }
.section-title { font-family:'Bebas Neue',sans-serif; font-size:20px; letter-spacing:2px; color:var(--text-dim); margin:16px 0 10px; }
.section-title:first-child { margin-top:4px; }
.quick-log-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin-bottom:16px; }
.category-card { position:relative; background:var(--surface); border-radius:var(--radius); padding:12px; cursor:pointer; border:2px solid transparent; transition:all .25s; overflow:hidden; }
.category-card::before { content:''; position:absolute; top:0;left:0;right:0; height:3px; background:var(--cat-color); opacity:.7; }
.category-card:active { transform:scale(.96); }
.category-card .card-icon { font-size:24px; margin-bottom:6px; display:block; }
.category-card .card-label { font-weight:600; font-size:12px; margin-bottom:2px; }
.category-card .card-sub { font-size:9px; color:var(--text-dim); }
.cal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.cal-nav { display:flex; gap:8px; }
.cal-nav button { background:var(--surface2); border:none; color:var(--text); width:32px; height:32px; border-radius:8px; cursor:pointer; font-size:16px; display:flex; align-items:center; justify-content:center; }
.cal-month { font-family:'Bebas Neue',sans-serif; font-size:18px; letter-spacing:2px; }
.cal-grid { display:grid; grid-template-columns:repeat(7,1fr); gap:4px; margin-bottom:16px; }
.cal-day-label { text-align:center; font-size:10px; color:var(--text-dim); font-weight:600; padding:4px 0; }
.cal-day { aspect-ratio:1; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:500; color:var(--text-dim); background:var(--surface); cursor:pointer; transition:all .2s; }
.cal-day.empty { background:transparent; cursor:default; }
.cal-day.today { border:2px solid var(--accent); color:var(--text); }
.cal-day.selected-date { border:2px solid var(--wellness); color:var(--text); box-shadow:0 0 8px rgba(255,194,51,0.3); }
.cal-day.has-activity { color:var(--text); font-weight:700; }
.cal-day.intensity-1 { background:rgba(255,94,58,0.15); }
.cal-day.intensity-2 { background:rgba(255,94,58,0.3); }
.cal-day.intensity-3 { background:rgba(255,94,58,0.5); }
.cal-day.intensity-4 { background:linear-gradient(135deg,rgba(255,94,58,0.7),rgba(255,45,120,0.5)); }
.cal-selected-banner { display:none; align-items:center; justify-content:space-between; background:var(--surface2); border:1px solid var(--wellness); border-radius:12px; padding:12px 16px; margin-bottom:12px; font-size:13px; font-weight:600; }
.cal-selected-banner.show { display:flex; }
.cal-selected-banner .add-for-date { background:linear-gradient(135deg,var(--accent),var(--accent2)); border:none; color:white; padding:8px 16px; border-radius:10px; font-size:12px; font-weight:700; font-family:inherit; cursor:pointer; }
.stat-row { display:flex; gap:10px; margin-bottom:12px; }
.stat-card { flex:1; background:var(--surface); border-radius:var(--radius); padding:16px; text-align:center; }
.stat-number { font-family:'Bebas Neue',sans-serif; font-size:36px; line-height:1; background:linear-gradient(135deg,var(--accent),var(--accent2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.stat-label { font-size:11px; color:var(--text-dim); font-weight:600; margin-top:4px; text-transform:uppercase; letter-spacing:1px; }
.breakdown-item { margin-bottom:14px; }
.breakdown-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
.breakdown-label { font-size:13px; font-weight:600; display:flex; align-items:center; gap:8px; }
.breakdown-dot { width:10px; height:10px; border-radius:50%; display:inline-block; }
.breakdown-count { font-size:12px; color:var(--text-dim); }
.breakdown-bar-bg { height:8px; background:var(--surface2); border-radius:4px; overflow:hidden; }
.breakdown-bar { height:100%; border-radius:4px; transition:width .6s cubic-bezier(.4,0,.2,1); }
.achievements-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:16px; }
.achievement { background:var(--surface); border-radius:var(--radius); padding:14px 10px; text-align:center; transition:all .3s; }
.achievement.locked { opacity:.35; filter:grayscale(1); }
.achievement.unlocked { border:1px solid rgba(255,194,51,0.3); background:linear-gradient(135deg,var(--surface),rgba(255,194,51,0.08)); }
.achievement .badge-icon { font-size:32px; display:block; margin-bottom:6px; }
.achievement .badge-name { font-size:11px; font-weight:700; margin-bottom:2px; }
.achievement .badge-desc { font-size:9px; color:var(--text-dim); }
.level-bar-container { background:var(--surface); border-radius:var(--radius); padding:16px; margin-bottom:16px; }
.level-info { display:flex; justify-content:space-between; align-items:baseline; margin-bottom:10px; }
.level-name { font-family:'Bebas Neue',sans-serif; font-size:22px; letter-spacing:2px; }
.level-xp { font-size:12px; color:var(--text-dim); }
.level-bar-bg { height:10px; background:var(--surface3); border-radius:5px; overflow:hidden; }
.level-bar-fill { height:100%; border-radius:5px; background:linear-gradient(90deg,var(--accent),var(--accent2)); transition:width .8s cubic-bezier(.4,0,.2,1); box-shadow:0 0 12px var(--accent-glow); }
.goal-card { background:var(--surface); border-radius:var(--radius); padding:16px; margin-bottom:10px; }
.goal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
.goal-title { font-size:14px; font-weight:700; display:flex; align-items:center; gap:8px; }
.goal-progress-text { font-size:12px; color:var(--text-dim); font-weight:600; }
.goal-bar-bg { height:8px; background:var(--surface3); border-radius:4px; overflow:hidden; }
.goal-bar-fill { height:100%; border-radius:4px; transition:width .6s ease; }
.goal-reward { font-size:11px; color:var(--wellness); margin-top:6px; font-weight:600; }
.streak-week { display:flex; gap:6px; margin-bottom:16px; }
.streak-day { flex:1; text-align:center; }
.streak-day-label { font-size:10px; color:var(--text-dim); margin-bottom:4px; font-weight:600; }
.streak-dot { width:28px; height:28px; border-radius:50%; margin:0 auto; display:flex; align-items:center; justify-content:center; font-size:14px; background:var(--surface2); }
.streak-dot.done { background:linear-gradient(135deg,var(--accent),var(--accent2)); box-shadow:0 2px 10px rgba(255,94,58,0.3); }
.modal-overlay { position:fixed; inset:0; background:rgba(0,0,0,0.7); z-index:100; display:none; align-items:flex-end; justify-content:center; animation:fadeIn .2s ease; }
.modal-overlay.show { display:flex; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
@keyframes slideUp { from{transform:translateY(100%)} to{transform:translateY(0)} }
.modal { background:var(--surface); border-radius:24px 24px 0 0; width:100%; max-width:500px; max-height:85dvh; overflow-y:auto; padding:24px 20px 40px; animation:slideUp .3s ease; }
.modal-handle { width:40px; height:4px; background:var(--surface3); border-radius:2px; margin:0 auto 20px; }
.modal-title { font-family:'Bebas Neue',sans-serif; font-size:24px; letter-spacing:2px; margin-bottom:6px; }
.modal-subtitle { font-size:12px; color:var(--text-dim); margin-bottom:16px; }
.modal-categories { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px; }
.modal-cat { background:var(--surface2); border:2px solid transparent; border-radius:12px; padding:14px; cursor:pointer; text-align:center; transition:all .2s; font-family:inherit; color:var(--text); font-size:13px; font-weight:600; }
.modal-cat:active { transform:scale(.96); }
.modal-cat.selected { border-color:var(--cat-color); background:rgba(255,255,255,0.05); }
.modal-cat .mc-icon { font-size:24px; display:block; margin-bottom:4px; }
.selected-cats-info { display:none; background:var(--surface2); border-radius:10px; padding:10px 14px; margin-bottom:16px; font-size:12px; color:var(--text-dim); }
.selected-cats-info.show { display:block; }
.form-group { margin-bottom:16px; }
.form-label { display:block; font-size:12px; font-weight:600; color:var(--text-dim); text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; }
.form-input,.form-textarea { width:100%; background:var(--surface2); border:1px solid var(--surface3); border-radius:12px; padding:12px 16px; color:var(--text); font-size:15px; font-family:inherit; outline:none; transition:border-color .2s; -webkit-appearance:none; }
.form-input:focus,.form-textarea:focus { border-color:var(--accent); }
.form-textarea { resize:none; min-height:60px; }
.duration-picker { display:flex; gap:8px; flex-wrap:wrap; }
.dur-chip { background:var(--surface2); border:2px solid transparent; border-radius:20px; padding:8px 16px; font-size:13px; font-weight:600; color:var(--text); cursor:pointer; font-family:inherit; transition:all .2s; }
.dur-chip.selected { border-color:var(--accent); background:rgba(255,94,58,0.15); color:var(--accent); }
.btn-save { width:100%; padding:16px; background:linear-gradient(135deg,var(--accent),var(--accent2)); border:none; border-radius:14px; color:white; font-size:16px; font-weight:700; font-family:inherit; cursor:pointer; letter-spacing:1px; box-shadow:0 4px 20px rgba(255,94,58,0.3); transition:transform .2s,opacity .2s; }
.btn-save:active { transform:scale(.97); }
.btn-save:disabled { opacity:.4; }
.recent-item { display:flex; align-items:center; gap:12px; background:var(--surface); border-radius:12px; padding:14px; margin-bottom:8px; }
.recent-icon { width:40px; height:40px; border-radius:10px; display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; }
.recent-info { flex:1; }
.recent-title { font-size:14px; font-weight:600; }
.recent-meta { font-size:11px; color:var(--text-dim); margin-top:2px; }
.recent-xp { font-size:13px; font-weight:700; color:var(--accent); }
.export-btn { display:flex; align-items:center; justify-content:center; gap:8px; width:100%; padding:14px; background:var(--surface); border:1px solid var(--surface3); border-radius:14px; color:var(--text); font-size:14px; font-weight:600; font-family:inherit; cursor:pointer; margin-bottom:12px; transition:all .2s; }
.export-btn:active { background:var(--surface2); }
.export-btn svg { width:20px; height:20px; }
.toast { position:fixed; top:40px; left:50%; transform:translateX(-50%) translateY(-120px); background:var(--surface2); border:1px solid var(--accent); color:var(--text); padding:14px 24px; border-radius:14px; font-size:14px; font-weight:600; z-index:200; transition:transform .4s cubic-bezier(.4,0,.2,1); box-shadow:0 8px 30px rgba(0,0,0,0.5); text-align:center; max-width:90vw; pointer-events:none; }
.toast.show { transform:translateX(-50%) translateY(0); }
.toast.achievement-toast { border-color:var(--wellness); background:linear-gradient(135deg,var(--surface2),rgba(255,194,51,0.1)); }
.day-activity { display:flex; align-items:center; gap:12px; padding:12px; background:var(--surface2); border-radius:12px; margin-bottom:8px; }
.day-activity-icon { font-size:24px; }
.day-activity-info { flex:1; }
.day-activity-name { font-weight:600; font-size:14px; }
.day-activity-meta { font-size:11px; color:var(--text-dim); }
.day-activity-del { background:none; border:none; color:var(--text-dim); font-size:18px; cursor:pointer; padding:4px 8px; }
.period-tabs { display:flex; background:var(--surface); border-radius:10px; padding:3px; margin-bottom:16px; }
.period-tab { flex:1; padding:8px; border:none; background:none; color:var(--text-dim); font-size:12px; font-weight:600; font-family:inherit; cursor:pointer; border-radius:8px; transition:all .2s; }
.period-tab.active { background:var(--surface3); color:var(--text); }
.milestone-track { display:flex; align-items:center; margin-bottom:16px; padding:0 4px; }
.milestone-line { flex:1; height:3px; background:var(--surface3); }
.milestone-line.filled { background:linear-gradient(90deg,var(--accent),var(--accent2)); }
.milestone-node { width:28px; height:28px; border-radius:50%; background:var(--surface3); display:flex; align-items:center; justify-content:center; font-size:10px; flex-shrink:0; z-index:1; font-weight:700; }
.milestone-node.reached { background:linear-gradient(135deg,var(--accent),var(--accent2)); box-shadow:0 2px 8px rgba(255,94,58,0.4); color:white; }
.empty-state { text-align:center; padding:40px 20px; color:var(--text-dim); }
.empty-state .empty-icon { font-size:48px; margin-bottom:12px; display:block; }
.empty-state p { font-size:14px; }
.backup-banner { display:flex; align-items:center; justify-content:space-between; background:var(--surface); border:1px solid rgba(44,180,160,0.3); border-radius:14px; padding:12px 14px; margin-bottom:12px; }
.backup-text { display:flex; align-items:center; gap:10px; }
.backup-icon { font-size:22px; }
.backup-title { font-size:13px; font-weight:700; }
.backup-sub { font-size:10px; color:var(--text-dim); margin-top:1px; }
.backup-actions { display:flex; align-items:center; gap:8px; }
.backup-btn { background:var(--yoga); border:none; color:var(--bg); padding:7px 14px; border-radius:8px; font-size:12px; font-weight:700; font-family:inherit; cursor:pointer; }
.backup-dismiss { background:none; border:none; color:var(--text-dim); font-size:16px; cursor:pointer; padding:4px; }
</style>
</head>
<body>
<div class="app">
  <div class="view-container" id="viewContainer">

    <!-- HOME -->
    <div class="view active" id="homeView">
      <div class="section-title" style="margin-top:4px">THIS WEEK</div>
      <div class="streak-week" id="streakWeek"></div>
      <div class="section-title">QUICK LOG</div>
      <div class="quick-log-grid">
        <div class="category-card" style="--cat-color:var(--cardio)" onclick="openLogModal(null,'cardio')"><span class="card-icon">üèÉ</span><div class="card-label">Cardio</div><div class="card-sub">Running, cycling, HIIT</div></div>
        <div class="category-card" style="--cat-color:var(--weights-upper)" onclick="openLogModal(null,'weights-upper')"><span class="card-icon">üí™</span><div class="card-label">Upper Body</div><div class="card-sub">Chest, back, arms</div></div>
        <div class="category-card" style="--cat-color:var(--weights-lower)" onclick="openLogModal(null,'weights-lower')"><span class="card-icon">ü¶µ</span><div class="card-label">Lower Body</div><div class="card-sub">Squats, deadlifts, legs</div></div>
        <div class="category-card" style="--cat-color:var(--yoga)" onclick="openLogModal(null,'yoga')"><span class="card-icon">üßò</span><div class="card-label">Yoga & Stretch</div><div class="card-sub">Flexibility, mobility</div></div>
        <div class="category-card" style="--cat-color:var(--wellness)" onclick="openLogModal(null,'wellness')"><span class="card-icon">üß†</span><div class="card-label">Wellness</div><div class="card-sub">Meditation, recovery</div></div>
        <div class="category-card" style="--cat-color:#e0e0e0" onclick="openLogModal(null,'other')"><span class="card-icon">üéØ</span><div class="card-label">Other</div><div class="card-sub">Sports, hiking, etc.</div></div>
      </div>
      <div class="section-title">WEEKLY GOALS</div>
      <div id="weeklyGoals"></div>
      <!-- Backup Banner -->
      <div class="backup-banner" id="backupBanner" style="display:none">
        <div class="backup-text">
          <span class="backup-icon">üíæ</span>
          <div>
            <div class="backup-title">Back up your data</div>
            <div class="backup-sub" id="backupSub">Protect your progress</div>
          </div>
        </div>
        <div class="backup-actions">
          <button class="backup-btn" onclick="quickBackup()">Backup</button>
          <button class="backup-dismiss" onclick="dismissBackup()">‚úï</button>
        </div>
      </div>

      <div class="section-title">RECENT ACTIVITIES</div>
      <div id="recentList"></div>
    </div>

    <!-- CALENDAR -->
    <div class="view" id="calendarView">
      <div class="cal-header">
        <div class="cal-nav"><button onclick="changeMonth(-1)">‚óÄ</button></div>
        <div class="cal-month" id="calMonth"></div>
        <div class="cal-nav"><button onclick="changeMonth(1)">‚ñ∂</button></div>
      </div>
      <div class="cal-grid" id="calGrid"></div>
      <div class="cal-selected-banner" id="calSelectedBanner">
        <span id="calSelectedLabel">üìÖ Select a date</span>
        <button class="add-for-date" onclick="addForSelectedDate()">+ Log Activity</button>
      </div>
      <button class="export-btn" onclick="exportToCalendar()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        Export to Calendar (.ics)
      </button>
      <div class="section-title">DAY DETAILS</div>
      <div id="dayDetail"><div class="empty-state"><span class="empty-icon">üìÖ</span><p>Tap a day to see activities</p></div></div>
    </div>

    <!-- STATS -->
    <div class="view" id="statsView">
      <div class="period-tabs">
        <button class="period-tab active" onclick="setStatsPeriod('week',this)">Week</button>
        <button class="period-tab" onclick="setStatsPeriod('month',this)">Month</button>
        <button class="period-tab" onclick="setStatsPeriod('all',this)">All Time</button>
      </div>
      <div class="stat-row">
        <div class="stat-card"><div class="stat-number" id="statWorkouts">0</div><div class="stat-label">Workouts</div></div>
        <div class="stat-card"><div class="stat-number" id="statMinutes">0</div><div class="stat-label">Minutes</div></div>
        <div class="stat-card"><div class="stat-number" id="statStreak">0</div><div class="stat-label">Streak</div></div>
      </div>
      <div class="stat-row">
        <div class="stat-card"><div class="stat-number" id="statBestStreak">0</div><div class="stat-label">Best Streak</div></div>
        <div class="stat-card"><div class="stat-number" id="statAvgPerWeek">0</div><div class="stat-label">Avg / Week</div></div>
        <div class="stat-card"><div class="stat-number" id="statTotalXP">0</div><div class="stat-label">Total XP</div></div>
      </div>
      <div class="section-title">CATEGORY BREAKDOWN</div>
      <div id="breakdownContainer"></div>
      <div class="section-title">FOCUS BALANCE</div>
      <div class="stat-row"><div class="stat-card"><div class="stat-number" id="balUpper">0</div><div class="stat-label">Upper Body</div></div><div class="stat-card"><div class="stat-number" id="balLower">0</div><div class="stat-label">Lower Body</div></div></div>
      <div class="stat-row" style="margin-bottom:16px"><div class="stat-card"><div class="stat-number" id="balCardio">0</div><div class="stat-label">Cardio</div></div><div class="stat-card"><div class="stat-number" id="balWellness">0</div><div class="stat-label">Wellness</div></div></div>
    </div>

    <!-- ACHIEVEMENTS -->
    <div class="view" id="achieveView">
      <div class="level-bar-container">
        <div class="level-info"><div class="level-name" id="levelName">Level 1 ‚Äî Beginner</div><div class="level-xp" id="levelXP">0 / 100 XP</div></div>
        <div class="level-bar-bg"><div class="level-bar-fill" id="levelBar" style="width:0%"></div></div>
      </div>
      <div class="section-title">WORKOUT MILESTONES</div>
      <div class="milestone-track" id="milestoneTrack"></div>
      <div class="section-title">ACHIEVEMENTS</div>
      <div class="achievements-grid" id="achievementsGrid"></div>
      <div class="section-title">SETTINGS</div>
      <button class="export-btn" onclick="exportData()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>Export All Data (JSON)</button>
      <button class="export-btn" onclick="importData()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>Import Data (JSON)</button>
      <input type="file" id="importFile" accept=".json" style="display:none" onchange="handleImport(event)">
      <button class="export-btn" style="color:#ff4444;border-color:rgba(255,68,68,0.3);margin-top:16px" onclick="clearAllData()">üóëÔ∏è Reset All Data</button>
    </div>
  </div>

  <!-- NAV -->
  <nav class="bottom-nav">
    <button class="nav-item active" onclick="switchView('homeView',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>Home</button>
    <button class="nav-item" onclick="switchView('calendarView',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Calendar</button>
    <button class="nav-item log-btn" onclick="openLogModal()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg></button>
    <button class="nav-item" onclick="switchView('statsView',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>Stats</button>
    <button class="nav-item" onclick="switchView('achieveView',this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>Badges</button>
  </nav>
</div>

<!-- LOG MODAL -->
<div class="modal-overlay" id="logModal" onclick="if(event.target===this)closeLogModal()">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">LOG ACTIVITY</div>
    <div class="modal-subtitle">Select one or more categories ‚Äî time splits evenly</div>
    <div class="modal-categories">
      <button class="modal-cat" style="--cat-color:var(--cardio)" data-cat="cardio" onclick="toggleCat(this)"><span class="mc-icon">üèÉ</span>Cardio</button>
      <button class="modal-cat" style="--cat-color:var(--weights-upper)" data-cat="weights-upper" onclick="toggleCat(this)"><span class="mc-icon">üí™</span>Upper Body</button>
      <button class="modal-cat" style="--cat-color:var(--weights-lower)" data-cat="weights-lower" onclick="toggleCat(this)"><span class="mc-icon">ü¶µ</span>Lower Body</button>
      <button class="modal-cat" style="--cat-color:var(--yoga)" data-cat="yoga" onclick="toggleCat(this)"><span class="mc-icon">üßò</span>Yoga</button>
      <button class="modal-cat" style="--cat-color:var(--wellness)" data-cat="wellness" onclick="toggleCat(this)"><span class="mc-icon">üß†</span>Wellness</button>
      <button class="modal-cat" style="--cat-color:#e0e0e0" data-cat="other" onclick="toggleCat(this)"><span class="mc-icon">üéØ</span>Other</button>
    </div>
    <div class="selected-cats-info" id="selectedCatsInfo"></div>
    <div class="form-group"><label class="form-label">Activity Name</label><input type="text" class="form-input" id="activityName" placeholder="e.g. Morning Run, Bench Press..."></div>
    <div class="form-group"><label class="form-label">Duration (total)</label>
      <div class="duration-picker">
        <button class="dur-chip" onclick="selectDuration(this,15)">15 min</button>
        <button class="dur-chip" onclick="selectDuration(this,30)">30 min</button>
        <button class="dur-chip" onclick="selectDuration(this,45)">45 min</button>
        <button class="dur-chip" onclick="selectDuration(this,60)">60 min</button>
        <button class="dur-chip" onclick="selectDuration(this,90)">90 min</button>
        <button class="dur-chip" onclick="selectDuration(this,120)">120 min</button>
      </div>
    </div>
    <div class="form-group"><label class="form-label">Date</label><input type="date" class="form-input" id="activityDate"></div>
    <div class="form-group"><label class="form-label">Notes (optional)</label><textarea class="form-textarea" id="activityNotes" placeholder="How did it feel?"></textarea></div>
    <button class="btn-save" id="saveBtn" onclick="saveActivity()" disabled>SAVE ACTIVITY ‚ö°</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const STORAGE_KEY='reach_data';
const CATEGORIES={'cardio':{icon:'üèÉ',label:'Cardio',color:'#ff5e3a',group:'cardio'},'weights-upper':{icon:'üí™',label:'Upper Body',color:'#7c5cff',group:'weights'},'weights-lower':{icon:'ü¶µ',label:'Lower Body',color:'#5ca0ff',group:'weights'},'yoga':{icon:'üßò',label:'Yoga & Stretch',color:'#2dd4a8',group:'wellness'},'wellness':{icon:'üß†',label:'Wellness',color:'#ffc233',group:'wellness'},'other':{icon:'üéØ',label:'Other',color:'#e0e0e0',group:'other'}};
const LEVELS=[{name:'Beginner',xp:0},{name:'Starter',xp:100},{name:'Mover',xp:250},{name:'Active',xp:450},{name:'Committed',xp:700},{name:'Dedicated',xp:1000},{name:'Disciplined',xp:1400},{name:'Warrior',xp:1900},{name:'Powerhouse',xp:2500},{name:'Champion',xp:3200},{name:'Elite',xp:4000},{name:'Legend',xp:5000},{name:'Mythic',xp:6500},{name:'Transcended',xp:8000},{name:'Immortal',xp:10000}];
const MILESTONES=[1,10,25,50,100,250,500];

function checkWeekendWarrior(d){const w={};d.activities.forEach(a=>{const dt=new Date(a.date);const day=dt.getDay();if(day===0||day===6){const ws=new Date(dt);ws.setDate(ws.getDate()-ws.getDay());const k=toDateStr(ws);if(!w[k])w[k]=new Set();w[k].add(day)}});return Object.values(w).some(s=>s.size===2)}
function checkConsistency(d){const wc={};d.activities.forEach(a=>{const dt=new Date(a.date);const ws=new Date(dt);ws.setDate(ws.getDate()-ws.getDay());const k=toDateStr(ws);wc[k]=(wc[k]||0)+1});let q=0;Object.values(wc).forEach(c=>{if(c>=4)q++});return q>=4}

const ACHIEVEMENTS=[
{id:'first',icon:'üåü',name:'First Step',desc:'Log first workout',check:d=>d.activities.length>=1},
{id:'five',icon:'‚úã',name:'High Five',desc:'Log 5 workouts',check:d=>d.activities.length>=5},
{id:'ten',icon:'üîü',name:'Double Digits',desc:'10 workouts',check:d=>d.activities.length>=10},
{id:'twenty5',icon:'üèÖ',name:'Quarter Century',desc:'25 workouts',check:d=>d.activities.length>=25},
{id:'fifty',icon:'üëë',name:'Half Century',desc:'50 workouts',check:d=>d.activities.length>=50},
{id:'hundred',icon:'üíé',name:'Centurion',desc:'100 workouts',check:d=>d.activities.length>=100},
{id:'two50',icon:'üèÜ',name:'Unstoppable Force',desc:'250 workouts',check:d=>d.activities.length>=250},
{id:'streak3',icon:'üî•',name:'On Fire',desc:'3-day streak',check:d=>getStreak(d)>=3},
{id:'streak7',icon:'üî•',name:'Week Warrior',desc:'7-day streak',check:d=>getStreak(d)>=7},
{id:'streak14',icon:'üî•',name:'Fortnight Force',desc:'14-day streak',check:d=>getStreak(d)>=14},
{id:'streak21',icon:'üî•',name:'Habit Formed',desc:'21-day streak',check:d=>getStreak(d)>=21},
{id:'streak30',icon:'üî•',name:'Iron Will',desc:'30-day streak',check:d=>getStreak(d)>=30},
{id:'streak60',icon:'üî•',name:'Diamond Discipline',desc:'60-day streak',check:d=>getStreak(d)>=60},
{id:'streak100',icon:'üî•',name:'Eternal Flame',desc:'100-day streak',check:d=>getStreak(d)>=100},
{id:'xp500',icon:'‚ö°',name:'Powerhouse',desc:'Earn 500 XP',check:d=>getTotalXP(d)>=500},
{id:'xp1000',icon:'‚ö°',name:'Energized',desc:'Earn 1,000 XP',check:d=>getTotalXP(d)>=1000},
{id:'xp2500',icon:'‚ö°',name:'Supercharged',desc:'Earn 2,500 XP',check:d=>getTotalXP(d)>=2500},
{id:'xp5000',icon:'‚ö°',name:'Electrifying',desc:'Earn 5,000 XP',check:d=>getTotalXP(d)>=5000},
{id:'allcats',icon:'üåà',name:'Well Rounded',desc:'Try all 6 categories',check:d=>new Set(d.activities.map(a=>a.category)).size>=6},
{id:'combo',icon:'üîÄ',name:'Combo Master',desc:'Multi-category session',check:d=>d.activities.some(a=>a.comboWith)},
{id:'balanced',icon:'‚öñÔ∏è',name:'Perfect Balance',desc:'10+ upper AND lower',check:d=>{const u=d.activities.filter(a=>a.category==='weights-upper').length;const l=d.activities.filter(a=>a.category==='weights-lower').length;return u>=10&&l>=10}},
{id:'hour',icon:'‚è±Ô∏è',name:'Hour Power',desc:'60+ min session',check:d=>d.activities.some(a=>a.duration>=60)},
{id:'marathon',icon:'‚è±Ô∏è',name:'Marathon Session',desc:'120+ min session',check:d=>d.activities.some(a=>a.duration>=120)},
{id:'min1000',icon:'‚è±Ô∏è',name:'Time Lord',desc:'1,000 total minutes',check:d=>d.activities.reduce((s,a)=>s+a.duration,0)>=1000},
{id:'min5000',icon:'‚è±Ô∏è',name:'Time Master',desc:'5,000 total minutes',check:d=>d.activities.reduce((s,a)=>s+a.duration,0)>=5000},
{id:'weekend',icon:'üéâ',name:'Weekend Warrior',desc:'Sat & Sun same week',check:d=>checkWeekendWarrior(d)},
{id:'earlybird',icon:'üåÖ',name:'Early Bird',desc:'Log before 7 AM',check:d=>d.activities.some(a=>new Date(a.logged).getHours()<7)},
{id:'nightowl',icon:'üåô',name:'Night Owl',desc:'Log after 10 PM',check:d=>d.activities.some(a=>new Date(a.logged).getHours()>=22)},
{id:'newyear',icon:'üéÜ',name:'New Year Grind',desc:'Log on Jan 1st',check:d=>d.activities.some(a=>a.date.endsWith('-01-01'))},
{id:'consistent',icon:'üìÖ',name:'Consistency King',desc:'4/week for 4 weeks',check:d=>checkConsistency(d)},
];

function loadData(){try{let r=localStorage.getItem(STORAGE_KEY);if(!r)r=localStorage.getItem('grind_data');if(r)return JSON.parse(r)}catch(e){}return{activities:[],unlockedAchievements:[],bestStreak:0}}
function saveStore(d){const s=getStreak(d);if(s>(d.bestStreak||0))d.bestStreak=s;localStorage.setItem(STORAGE_KEY,JSON.stringify(d))}

let data=loadData();let calYear,calMonth;let selectedCats=[];let selectedDuration=null;let statsPeriod='week';let selectedCalDate=null;
const now=new Date();calYear=now.getFullYear();calMonth=now.getMonth();

function toDateStr(d){return d.getFullYear()+'-'+String(d.getMonth()+1).padStart(2,'0')+'-'+String(d.getDate()).padStart(2,'0')}
function dateKey(d){return typeof d==='string'?d.split('T')[0]:toDateStr(d)}
function getTotalXP(d){return d.activities.reduce((s,a)=>s+(a.xp||0),0)}
function getStreak(d){if(!d.activities.length)return 0;const days=new Set(d.activities.map(a=>dateKey(a.date)));const t=toDateStr(new Date());const y=toDateStr(new Date(Date.now()-864e5));if(!days.has(t)&&!days.has(y))return 0;let s=0,c=days.has(t)?new Date():new Date(Date.now()-864e5);while(days.has(toDateStr(c))){s++;c=new Date(c.getTime()-864e5)}return s}
function calcXP(dur){if(dur>=120)return 60;if(dur>=90)return 50;if(dur>=60)return 40;if(dur>=45)return 30;if(dur>=30)return 20;return 10}
function getLevel(xp){let l=0;for(let i=LEVELS.length-1;i>=0;i--)if(xp>=LEVELS[i].xp){l=i;break}const c=LEVELS[l],n=LEVELS[l+1]||{xp:c.xp+2000};const p=(xp-c.xp)/(n.xp-c.xp);return{level:l+1,name:c.name,progress:Math.min(p,1),currentXP:xp-c.xp,neededXP:n.xp-c.xp}}

let toastTimeout=null;
function showToast(msg,type){const t=document.getElementById('toast');t.textContent=msg;t.className='toast'+(type==='achievement'?' achievement-toast':'');clearTimeout(toastTimeout);requestAnimationFrame(()=>{t.classList.add('show');toastTimeout=setTimeout(()=>t.classList.remove('show'),3000)})}

function switchView(id,btn){document.querySelectorAll('.view').forEach(v=>v.classList.remove('active'));document.getElementById(id).classList.add('active');document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));if(btn)btn.classList.add('active');document.getElementById('viewContainer').scrollTop=0;if(id==='calendarView')renderCalendar();if(id==='statsView')renderStats();if(id==='achieveView')renderAchievements();if(id==='homeView'){renderStreakWeek();renderWeeklyGoals()}}

function renderStreakWeek(){const c=document.getElementById('streakWeek');const labels=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];const today=new Date();const sow=new Date(today);sow.setDate(today.getDate()-today.getDay());const ad=new Set(data.activities.map(a=>dateKey(a.date)));let h='';for(let i=0;i<7;i++){const d=new Date(sow);d.setDate(sow.getDate()+i);const ds=toDateStr(d);const done=ad.has(ds);const isT=ds===toDateStr(today);const isF=d>today;h+=`<div class="streak-day"><div class="streak-day-label">${labels[i]}</div><div class="streak-dot ${done?'done':''}" style="${isT&&!done?'border:2px solid var(--accent)':''}">${done?'‚úì':isF?'':'¬∑'}</div></div>`}c.innerHTML=h}

function renderWeeklyGoals(){const c=document.getElementById('weeklyGoals');const today=new Date();const sow=new Date(today);sow.setDate(today.getDate()-today.getDay());const ws=toDateStr(sow);const wa=data.activities.filter(a=>a.date>=ws);const wd=new Set(wa.map(a=>a.date));const wm=wa.reduce((s,a)=>s+a.duration,0);const wx=wa.reduce((s,a)=>s+(a.xp||0),0);const wc=new Set(wa.map(a=>a.category));const goals=[{icon:'üìÖ',title:'Active 4 days this week',current:wd.size,target:4,color:'var(--accent)',reward:'+20 bonus XP'},{icon:'‚è±Ô∏è',title:'Log 150 minutes this week',current:wm,target:150,color:'var(--yoga)',reward:'+30 bonus XP'},{icon:'üåà',title:'Try 3 different categories',current:wc.size,target:3,color:'var(--weights-upper)',reward:'+15 bonus XP'},{icon:'‚ö°',title:'Earn 100 XP this week',current:wx,target:100,color:'var(--wellness)',reward:'Level boost'}];c.innerHTML=goals.map(g=>{const pct=Math.min((g.current/g.target)*100,100);const done=g.current>=g.target;return`<div class="goal-card"><div class="goal-header"><div class="goal-title">${g.icon} ${g.title}</div><div class="goal-progress-text">${g.current}/${g.target}${done?' ‚úÖ':''}</div></div><div class="goal-bar-bg"><div class="goal-bar-fill" style="width:${pct}%;background:${g.color}"></div></div>${!done?`<div class="goal-reward">üéÅ ${g.reward}</div>`:''}</div>`}).join('')}

function openLogModal(dateStr,cat){document.getElementById('logModal').classList.add('show');selectedCats=[];selectedDuration=null;document.getElementById('activityName').value='';document.getElementById('activityNotes').value='';document.getElementById('activityDate').value=dateStr||toDateStr(new Date());document.querySelectorAll('.modal-cat').forEach(c=>c.classList.remove('selected'));document.querySelectorAll('.dur-chip').forEach(c=>c.classList.remove('selected'));document.getElementById('saveBtn').disabled=true;updateCatInfo();if(cat){const btn=document.querySelector(`.modal-cat[data-cat="${cat}"]`);if(btn)toggleCat(btn)}}
function closeLogModal(){document.getElementById('logModal').classList.remove('show')}
function toggleCat(el){const cat=el.dataset.cat;if(el.classList.contains('selected')){el.classList.remove('selected');selectedCats=selectedCats.filter(c=>c!==cat)}else{el.classList.add('selected');selectedCats.push(cat)}updateCatInfo();validateForm()}
function updateCatInfo(){const info=document.getElementById('selectedCatsInfo');if(selectedCats.length>1&&selectedDuration){const pc=Math.round(selectedDuration/selectedCats.length);const lb=selectedCats.map(c=>CATEGORIES[c].label).join(', ');info.textContent=`‚è±Ô∏è ${selectedDuration} min split ‚Üí ${pc} min each for: ${lb}`;info.classList.add('show')}else if(selectedCats.length>1){info.textContent=`üìã Selected: ${selectedCats.map(c=>CATEGORIES[c].label).join(', ')} ‚Äî pick duration to see split`;info.classList.add('show')}else{info.classList.remove('show')}}
function selectDuration(el,mins){document.querySelectorAll('.dur-chip').forEach(c=>c.classList.remove('selected'));el.classList.add('selected');selectedDuration=mins;updateCatInfo();validateForm()}
function validateForm(){document.getElementById('saveBtn').disabled=!(selectedCats.length>0&&selectedDuration)}

function saveActivity(){if(!selectedCats.length||!selectedDuration)return;const perCat=Math.round(selectedDuration/selectedCats.length);const baseName=document.getElementById('activityName').value;const date=document.getElementById('activityDate').value;const notes=document.getElementById('activityNotes').value;const isCombo=selectedCats.length>1;let totalXP=0;const comboId=isCombo?Date.now().toString(36):null;
selectedCats.forEach((cat,i)=>{const xp=calcXP(perCat);totalXP+=xp;const ci=CATEGORIES[cat];const name=baseName||(isCombo?ci.label+' (combo)':ci.label);data.activities.push({id:Date.now().toString(36)+Math.random().toString(36).slice(2,6)+i,category:cat,name:name,duration:perCat,date:date,notes:notes,xp:xp,logged:new Date().toISOString(),comboWith:isCombo?comboId:null})});
const streak=getStreak(data);let bonus=0;if(streak>=30)bonus=15;else if(streak>=14)bonus=10;else if(streak>=7)bonus=5;else if(streak>=3)bonus=2;if(bonus>0){totalXP+=bonus;data.activities[data.activities.length-1].xp+=bonus}
const newA=[];ACHIEVEMENTS.forEach(a=>{if(!data.unlockedAchievements.includes(a.id)&&a.check(data)){data.unlockedAchievements.push(a.id);newA.push(a)}});
const xpB=getTotalXP(data)-totalXP;const lB=getLevel(xpB);const lA=getLevel(getTotalXP(data));const lvlUp=lA.level>lB.level;
saveStore(data);closeLogModal();
let msg=`+${totalXP} XP earned!`;if(bonus>0)msg+=` (üî• streak +${bonus})`;showToast(msg);
if(lvlUp)setTimeout(()=>showToast(`üéâ LEVEL UP! Level ${lA.level} ‚Äî ${lA.name}`,'achievement'),2000);
if(newA.length)newA.forEach((a,i)=>setTimeout(()=>showToast(`üèÜ ${a.name} ‚Äî ${a.desc}`,'achievement'),3500+i*2000));
renderRecent();renderStreakWeek();renderWeeklyGoals()}

function renderRecent(){const l=document.getElementById('recentList');const r=[...data.activities].reverse().slice(0,10);if(!r.length){l.innerHTML='<div class="empty-state"><span class="empty-icon">üèãÔ∏è</span><p>No activities yet. Tap a category to start!</p></div>';return}l.innerHTML=r.map(a=>{const c=CATEGORIES[a.category]||CATEGORIES.other;return`<div class="recent-item"><div class="recent-icon" style="background:${c.color}22">${c.icon}</div><div class="recent-info"><div class="recent-title">${a.name}${a.comboWith?' üîÄ':''}</div><div class="recent-meta">${a.date} ¬∑ ${a.duration} min</div></div><div class="recent-xp">+${a.xp} XP</div></div>`}).join('')}

function changeMonth(dir){calMonth+=dir;if(calMonth<0){calMonth=11;calYear--}if(calMonth>11){calMonth=0;calYear++}selectedCalDate=null;renderCalendar()}
function renderCalendar(){const mn=['JANUARY','FEBRUARY','MARCH','APRIL','MAY','JUNE','JULY','AUGUST','SEPTEMBER','OCTOBER','NOVEMBER','DECEMBER'];document.getElementById('calMonth').textContent=mn[calMonth]+' '+calYear;const g=document.getElementById('calGrid');const dl=['S','M','T','W','T','F','S'];let h=dl.map(d=>`<div class="cal-day-label">${d}</div>`).join('');const fd=new Date(calYear,calMonth,1).getDay();const dim=new Date(calYear,calMonth+1,0).getDate();const today=toDateStr(new Date());const dc={};data.activities.forEach(a=>{if(a.date.startsWith(calYear+'-'+String(calMonth+1).padStart(2,'0')))dc[a.date]=(dc[a.date]||0)+1});for(let i=0;i<fd;i++)h+='<div class="cal-day empty"></div>';for(let d=1;d<=dim;d++){const ds=calYear+'-'+String(calMonth+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');const cnt=dc[ds]||0;let cls='cal-day';if(ds===today)cls+=' today';if(ds===selectedCalDate)cls+=' selected-date';if(cnt>0){cls+=' has-activity';if(cnt>=4)cls+=' intensity-4';else if(cnt>=3)cls+=' intensity-3';else if(cnt>=2)cls+=' intensity-2';else cls+=' intensity-1'}h+=`<div class="${cls}" onclick="selectCalDay('${ds}')">${d}</div>`}g.innerHTML=h;updateCalBanner()}
function selectCalDay(ds){selectedCalDate=ds;renderCalendar();showDay(ds)}
function updateCalBanner(){const b=document.getElementById('calSelectedBanner');if(selectedCalDate){const d=new Date(selectedCalDate+'T12:00:00');document.getElementById('calSelectedLabel').textContent='üìÖ '+d.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric'});b.classList.add('show')}else{b.classList.remove('show')}}
function addForSelectedDate(){if(selectedCalDate)openLogModal(selectedCalDate)}
function showDay(ds){const acts=data.activities.filter(a=>a.date===ds);const d=document.getElementById('dayDetail');if(!acts.length){d.innerHTML='<div class="empty-state"><span class="empty-icon">üò¥</span><p>No activities on this day</p></div>';return}d.innerHTML=acts.map(a=>{const c=CATEGORIES[a.category]||CATEGORIES.other;return`<div class="day-activity"><div class="day-activity-icon">${c.icon}</div><div class="day-activity-info"><div class="day-activity-name">${a.name}${a.comboWith?' üîÄ':''}</div><div class="day-activity-meta">${a.duration} min ¬∑ +${a.xp} XP${a.notes?' ¬∑ '+a.notes:''}</div></div><button class="day-activity-del" onclick="deleteActivity('${a.id}')">‚úï</button></div>`}).join('')}
function deleteActivity(id){if(!confirm('Delete this activity?'))return;data.activities=data.activities.filter(a=>a.id!==id);saveStore(data);renderRecent();renderStreakWeek();renderWeeklyGoals();renderCalendar();if(selectedCalDate)showDay(selectedCalDate);showToast('Activity deleted')}

function setStatsPeriod(p,btn){statsPeriod=p;document.querySelectorAll('.period-tab').forEach(t=>t.classList.remove('active'));btn.classList.add('active');renderStats()}
function getFilteredActivities(){const n=new Date();if(statsPeriod==='week')return data.activities.filter(a=>new Date(a.date)>=new Date(n.getTime()-7*864e5));if(statsPeriod==='month')return data.activities.filter(a=>new Date(a.date)>=new Date(n.getTime()-30*864e5));return[...data.activities]}
function renderStats(){const f=getFilteredActivities();const tm=f.reduce((s,a)=>s+a.duration,0);document.getElementById('statWorkouts').textContent=f.length;document.getElementById('statMinutes').textContent=tm;document.getElementById('statStreak').textContent=getStreak(data);document.getElementById('statBestStreak').textContent=data.bestStreak||getStreak(data);document.getElementById('statTotalXP').textContent=getTotalXP(data);if(data.activities.length>0){const dates=data.activities.map(a=>new Date(a.date));const earliest=new Date(Math.min(...dates));const weeks=Math.max(1,Math.ceil((Date.now()-earliest.getTime())/(7*864e5)));document.getElementById('statAvgPerWeek').textContent=Math.round(data.activities.length/weeks*10)/10}else{document.getElementById('statAvgPerWeek').textContent='0'}const cc={};Object.keys(CATEGORIES).forEach(k=>cc[k]=0);f.forEach(a=>cc[a.category]=(cc[a.category]||0)+1);const mx=Math.max(...Object.values(cc),1);document.getElementById('breakdownContainer').innerHTML=Object.entries(CATEGORIES).map(([k,c])=>{const cnt=cc[k]||0;return`<div class="breakdown-item"><div class="breakdown-header"><div class="breakdown-label"><span class="breakdown-dot" style="background:${c.color}"></span>${c.label}</div><div class="breakdown-count">${cnt}</div></div><div class="breakdown-bar-bg"><div class="breakdown-bar" style="width:${(cnt/mx)*100}%;background:${c.color}"></div></div></div>`}).join('');document.getElementById('balUpper').textContent=f.filter(a=>a.category==='weights-upper').length;document.getElementById('balLower').textContent=f.filter(a=>a.category==='weights-lower').length;document.getElementById('balCardio').textContent=f.filter(a=>a.category==='cardio').length;document.getElementById('balWellness').textContent=f.filter(a=>['yoga','wellness'].includes(a.category)).length}

function renderAchievements(){const xp=getTotalXP(data);const l=getLevel(xp);document.getElementById('levelName').textContent=`Level ${l.level} ‚Äî ${l.name}`;document.getElementById('levelXP').textContent=`${l.currentXP} / ${l.neededXP} XP`;document.getElementById('levelBar').style.width=(l.progress*100)+'%';const cnt=data.activities.length;let th='';MILESTONES.forEach((m,i)=>{const r=cnt>=m;if(i>0)th+=`<div class="milestone-line ${cnt>=m?'filled':''}"></div>`;th+=`<div class="milestone-node ${r?'reached':''}">${r?'‚úì':m}</div>`});document.getElementById('milestoneTrack').innerHTML=th;document.getElementById('achievementsGrid').innerHTML=ACHIEVEMENTS.map(a=>{const u=data.unlockedAchievements.includes(a.id);return`<div class="achievement ${u?'unlocked':'locked'}"><span class="badge-icon">${a.icon}</span><div class="badge-name">${a.name}</div><div class="badge-desc">${a.desc}</div></div>`}).join('')}

function exportToCalendar(){if(!data.activities.length){showToast('No activities to export');return}let ics='BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//REACH//Workout Tracker//EN\nCALSCALE:GREGORIAN\n';data.activities.forEach(a=>{const c=CATEGORIES[a.category]||CATEGORIES.other;ics+=`BEGIN:VEVENT\nDTSTART;VALUE=DATE:${a.date.replace(/-/g,'')}\nDTEND;VALUE=DATE:${a.date.replace(/-/g,'')}\nSUMMARY:${c.icon} ${a.name} (${a.duration} min)\nDESCRIPTION:Category: ${c.label}\\nDuration: ${a.duration} min\\nXP: ${a.xp}${a.notes?'\\nNotes: '+a.notes:''}\nUID:${a.id}@reach\nEND:VEVENT\n`});ics+='END:VCALENDAR';const b=new Blob([ics],{type:'text/calendar'});const u=URL.createObjectURL(b);const l=document.createElement('a');l.href=u;l.download='reach-workouts.ics';l.click();URL.revokeObjectURL(u);showToast('Calendar file downloaded!')}
function exportData(){const b=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});const u=URL.createObjectURL(b);const l=document.createElement('a');l.href=u;l.download='reach-backup-'+toDateStr(new Date())+'.json';l.click();URL.revokeObjectURL(u);showToast('Data exported!')}
function importData(){document.getElementById('importFile').click()}
function handleImport(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=function(ev){try{const imp=JSON.parse(ev.target.result);if(imp.activities){data=imp;saveStore(data);renderRecent();renderStreakWeek();renderWeeklyGoals();showToast('Data imported!')}else showToast('Invalid file')}catch(err){showToast('Error reading file')}};r.readAsText(f);e.target.value=''}
function clearAllData(){if(!confirm('Delete ALL data? Cannot be undone!'))return;data={activities:[],unlockedAchievements:[],bestStreak:0};saveStore(data);renderRecent();renderStreakWeek();renderWeeklyGoals();showToast('All data cleared')}

renderRecent();renderStreakWeek();renderWeeklyGoals();

// ‚îÄ‚îÄ‚îÄ BACKUP SYSTEM ‚îÄ‚îÄ‚îÄ
const BACKUP_KEY='reach_last_backup';

// Auto-backup to a second localStorage key every time data is saved
function autoBackup(){
  if(!data.activities.length)return;
  try{localStorage.setItem('reach_backup_auto',JSON.stringify(data))}catch(e){}
}
autoBackup();

// Restore from auto-backup if main data is empty but backup exists
(function checkAutoRestore(){
  if(data.activities.length===0){
    try{
      const backup=localStorage.getItem('reach_backup_auto');
      if(backup){
        const parsed=JSON.parse(backup);
        if(parsed.activities&&parsed.activities.length>0){
          if(confirm('Found a backup with '+parsed.activities.length+' activities. Restore it?')){
            data=parsed;saveStore(data);renderRecent();renderStreakWeek();renderWeeklyGoals();
            showToast('Restored '+data.activities.length+' activities from backup!');
          }
        }
      }
    }catch(e){}
  }
})();

// Check if we should show the backup reminder banner
function checkBackupReminder(){
  const banner=document.getElementById('backupBanner');
  if(!data.activities.length){banner.style.display='none';return}
  const lb=localStorage.getItem(BACKUP_KEY);
  if(!lb){
    document.getElementById('backupSub').textContent=data.activities.length+' activities ‚Äî never backed up to file!';
    banner.style.display='flex';return;
  }
  try{
    const info=JSON.parse(lb);
    const newSince=data.activities.length-(info.count||0);
    const daysSince=Math.floor((Date.now()-new Date(info.time).getTime())/864e5);
    if(newSince>=5||daysSince>=7){
      document.getElementById('backupSub').textContent=newSince>0?newSince+' new activities since last backup':'Last backup '+daysSince+' days ago';
      banner.style.display='flex';
    }else{banner.style.display='none'}
  }catch(e){banner.style.display='flex'}
}

function quickBackup(){
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const link=document.createElement('a');
  link.href=url;link.download='reach-backup-'+toDateStr(new Date())+'.json';link.click();
  URL.revokeObjectURL(url);
  localStorage.setItem(BACKUP_KEY,JSON.stringify({time:new Date().toISOString(),count:data.activities.length}));
  document.getElementById('backupBanner').style.display='none';
  showToast('‚úÖ Backup saved! Keep the file safe.');
}

function dismissBackup(){document.getElementById('backupBanner').style.display='none'}

checkBackupReminder();

// Also auto-backup before every save
const origSaveStore=saveStore;
saveStore=function(d){origSaveStore(d);autoBackup()};

// ‚îÄ‚îÄ‚îÄ SERVICE WORKER (auto-update, no cache clearing needed) ‚îÄ‚îÄ‚îÄ
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js').then(reg=>{
    reg.update();
    reg.addEventListener('updatefound',()=>{
      const newWorker=reg.installing;
      newWorker.addEventListener('statechange',()=>{
        if(newWorker.state==='installed'&&navigator.serviceWorker.controller){
          try{localStorage.setItem('reach_backup_auto',JSON.stringify(data))}catch(e){}
          newWorker.postMessage('skipWaiting');
        }
      });
    });
    let refreshing=false;
    navigator.serviceWorker.addEventListener('controllerchange',()=>{
      if(!refreshing){refreshing=true;window.location.reload()}
    });
  }).catch(()=>{});
}
</script>
</body>
</html>
